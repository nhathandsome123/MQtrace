global
    log stdout format raw local0
    maxconn 2048
    tune.ssl.default-dh-param 2048

defaults
    log global
    mode tcp
    option tcplog
    timeout connect 10s
    timeout client 1m
    timeout server 1m

# ==========================================================
# ğŸ” Frontend - TLS Listener (Port 8883)
# ==========================================================
frontend mqtt_tls
    bind *:8883 ssl crt /usr/local/etc/haproxy/certs/server.pem
    mode tcp
    default_backend mqtt_plain

# ==========================================================
# ğŸ”„ Backend - Plain MQTT to EMQX (Port 1883)
# ==========================================================
backend mqtt_plain
    mode tcp
    balance roundrobin
    option tcplog
    server emqx 127.0.0.1:1883 check
